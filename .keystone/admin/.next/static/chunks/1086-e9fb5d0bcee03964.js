(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1086],{21086:function(e,t,i){"use strict";i.d(t,{p:function(){return I}});var l=i(7896),n=i(34273),a=i.n(n),o=i(5632),r=i(2784),s=i(25631),d=i(25445),u=i(66759),c=i(13123),m=i(8999),g=i(43900),v=i(55364),h=i(29730),f=i(17400),p=i(31054),Z=i(9747);i(43910);var y=i(85660),w=i(33379),x=i(10081),b=i(40794),C=i(91321),k=i(70814),F=i(34838),M=i(31928),$=i(20927);function E(e){let t=(0,r.useRef)(e),i=(0,r.useCallback)(function(){return t.current(...arguments)},[]);return(0,r.useEffect)(()=>{t.current=e}),i}function S(e){var t,i,n;let{listKey:o,itemGetter:u,selectedFields:m,fieldModes:g,fieldPositions:b,showDelete:k,item:M}=e,$=(0,C.sm)(o),{spacing:S,typography:I}=(0,d.Fg)(),[R,{loading:q,error:N,data:P}]=(0,w.D)(x.Ps`mutation ($data: ${$.gqlNames.updateInputName}!, $id: ID!) {
      item: ${$.gqlNames.updateMutationName}(where: { id: $id }, data: $data) {
        ${m}
      }
    }`,{errorPolicy:"all"});u=null!==(t=(0,r.useMemo)(()=>{if(P)return(0,p.m)(P,null==N?void 0:N.graphQLErrors).get("item")},[P,N]))&&void 0!==t?t:u;let[L,V]=(0,r.useState)(()=>{let e=(0,y.d)($.fields,u);return{value:e,item:u}});if(!q&&L.item.data!==u.data&&(u.errors||[]).every(e=>{var t;return(null===(t=e.path)||void 0===t?void 0:t.length)!==1})){let e=(0,y.d)($.fields,u);V({value:e,item:u})}let{changedFields:X,dataForUpdate:K}=(0,y.u)($.fields,L.item,L.value),Q=(0,y.a)($.fields,L.value),[O,A]=(0,r.useState)(!1),B=(0,v.e)(),W=E(()=>{let e=0!==Q.size;A(e),e||R({variables:{data:K,id:L.item.get("id").data}}).then(e=>{let{errors:t}=e,i=null==t?void 0:t.find(e=>{var t;return void 0===e.path||(null===(t=e.path)||void 0===t?void 0:t.length)===1});i?B.addToast({title:"Failed to update item",tone:"negative",message:i.message}):B.addToast({tone:"positive",title:"Saved successfully"})}).catch(e=>{B.addToast({title:"Failed to update item",tone:"negative",message:e.message})})}),j=$.isSingleton?$.label:null===(i=L.item.data)||void 0===i?void 0:i[$.labelField],_=null===(n=L.item.data)||void 0===n?void 0:n.id,G=!!X.size;return(0,F.u)((0,r.useMemo)(()=>({current:G}),[G])),(0,d.tZ)(r.Fragment,null,(0,d.tZ)(d.xu,{marginTop:"xlarge"},(0,d.tZ)(F.G,{networkError:null==N?void 0:N.networkError,errors:null==N?void 0:N.graphQLErrors.filter(e=>{var t;return(null===(t=e.path)||void 0===t?void 0:t.length)===1})}),(0,d.tZ)(Z.F,{groups:$.groups,fieldModes:g,fields:$.fields,forceValidation:O,invalidFields:Q,position:"form",fieldPositions:b,onChange:(0,r.useCallback)(e=>{V(t=>({item:t.item,value:e(t.value)}))},[V]),value:L.value}),(0,d.tZ)(T,{onSave:W,hasChangedFields:!!X.size,onReset:E(()=>{V(e=>({item:e.item,value:(0,y.d)($.fields,e.item)}))}),loading:q,deleteButton:(0,r.useMemo)(()=>k?(0,d.tZ)(D,{list:$,itemLabel:null!=j?j:_,itemId:_}):void 0,[k,$,j,_])})),(0,d.tZ)(z,null,(0,d.tZ)(f.Qy,null,"Item ID"),(0,d.tZ)("div",{css:{display:"flex",alignItems:"center"}},(0,d.tZ)(f.oi,{css:{marginRight:S.medium,fontFamily:I.fontFamily.monospace,fontSize:I.fontSize.small},readOnly:!0,value:M.id}),(0,d.tZ)(h.u,{content:"Copy ID"},e=>(0,d.tZ)(s.zx,(0,l.Z)({},e,{"aria-label":"Copy ID",onClick:()=>{a()(M.id)}}),(0,d.tZ)(c.K,{size:"small"})))),(0,d.tZ)(d.xu,{marginTop:"xlarge"},(0,d.tZ)(Z.F,{groups:$.groups,fieldModes:g,fields:$.fields,forceValidation:O,invalidFields:Q,position:"sidebar",fieldPositions:b,onChange:(0,r.useCallback)(e=>{V(t=>({item:t.item,value:e(t.value)}))},[V]),value:L.value}))))}function D(e){let{itemLabel:t,itemId:i,list:l}=e,n=(0,v.e)(),[a,{loading:u}]=(0,w.D)(x.Ps`mutation ($id: ID!) {
      ${l.gqlNames.deleteMutationName}(where: { id: $id }) {
        id
      }
    }`,{variables:{id:i}}),[c,g]=(0,r.useState)(!1),h=(0,o.useRouter)();return(0,d.tZ)(r.Fragment,null,(0,d.tZ)(s.zx,{tone:"negative",onClick:()=>{g(!0)}},"Delete"),(0,d.tZ)(m.aR,{title:"Delete Confirmation",isOpen:c,tone:"negative",actions:{confirm:{label:"Delete",action:async()=>{try{await a()}catch(e){return n.addToast({title:`Failed to delete ${l.singular} item: ${t}`,message:e.message,tone:"negative"})}return h.push(l.isSingleton?"/":`/${l.path}`),n.addToast({title:t,message:`Deleted ${l.singular} item successfully`,tone:"positive"})},loading:u},cancel:{label:"Cancel",action:()=>{g(!1)}}}},"Are you sure you want to delete ",(0,d.tZ)("strong",null,t),"?"))}i(69378),i(38717),i(74002),i(17132),i(37668),i(51168),i(35976),i(10581),i(74176),i(80487),i(40891),i(25273),i(51511),i(39097),i(97729),i(80444);let I=e=>()=>(0,d.tZ)(R,e),R=e=>{var t,i,l,n,a,s,c,m;let{listKey:v}=e,h=(0,C.sm)(v),f=(0,o.useRouter)().query.id,{query:Z,selectedFields:y}=(0,r.useMemo)(()=>{let e=Object.entries(h.fields).filter(e=>{let[t,i]=e;return"hidden"!==i.itemView.fieldMode||"id"===t}).map(e=>{let[t]=e;return h.fields[t].controller.graphqlSelection}).join("\n");return{selectedFields:e,query:x.Ps`
        query ItemPage($id: ID!, $listKey: String!) {
          item: ${h.gqlNames.itemQueryName}(where: {id: $id}) {
            ${e}
          }
          keystone {
            adminMeta {
              list(key: $listKey) {
                hideCreate
                hideDelete
                fields {
                  path
                  itemView(id: $id) {
                    fieldMode
                    fieldPosition
                  }
                }
              }
            }
          }
        }
      `}},[h]),{data:w,error:E,loading:D}=(0,b.a)(Z,{variables:{id:f,listKey:v},errorPolicy:"all",skip:void 0===f});D||(D=void 0===f);let I=(0,p.m)(w,null==E?void 0:E.graphQLErrors),R=(0,r.useMemo)(()=>{var e,t,i,l,n;let a={};return null===(e=I.data)||void 0===e||null===(t=e.keystone)||void 0===t||null===(i=t.adminMeta)||void 0===i||null===(l=i.list)||void 0===l||null===(n=l.fields)||void 0===n||n.forEach(e=>{var t;null!==e&&null!==e.path&&(null==e?void 0:null===(t=e.itemView)||void 0===t?void 0:t.fieldMode)!=null&&(a[e.path]=e.itemView.fieldMode)}),a},[null===(t=I.data)||void 0===t?void 0:null===(i=t.keystone)||void 0===i?void 0:null===(l=i.adminMeta)||void 0===l?void 0:null===(n=l.list)||void 0===n?void 0:n.fields]),T=(0,r.useMemo)(()=>{var e,t,i,l,n;let a={};return null===(e=I.data)||void 0===e||null===(t=e.keystone)||void 0===t||null===(i=t.adminMeta)||void 0===i||null===(l=i.list)||void 0===l||null===(n=l.fields)||void 0===n||n.forEach(e=>{var t;null!==e&&null!==e.path&&(null==e?void 0:null===(t=e.itemView)||void 0===t?void 0:t.fieldPosition)!=null&&(a[e.path]=e.itemView.fieldPosition)}),a},[null===(a=I.data)||void 0===a?void 0:null===(s=a.keystone)||void 0===s?void 0:null===(c=s.adminMeta)||void 0===c?void 0:null===(m=c.list)||void 0===m?void 0:m.fields]),q=I.get("keystone").errors,z=h.isSingleton?h.label:D?void 0:w&&w.item&&(w.item[h.labelField]||w.item.id)||f;return(0,d.tZ)(k.P,{title:z,header:(0,d.tZ)($.I,{list:h,label:D?"Loading...":w&&w.item&&(w.item[h.labelField]||w.item.id)||f})},D?(0,d.tZ)(d.M5,{css:{height:`calc(100vh - ${k.H}px)`}},(0,d.tZ)(u.xg,{label:"Loading item data",size:"large",tone:"passive"})):q?(0,d.tZ)(d.xu,{marginY:"xlarge"},(0,d.tZ)(g.qX,{tone:"negative"},q[0].message)):(0,d.tZ)($.C,null,(null==w?void 0:w.item)==null?(0,d.tZ)(d.xu,{marginY:"xlarge"},null!=E&&E.graphQLErrors.length||null!=E&&E.networkError?(0,d.tZ)(F.G,{errors:null==E?void 0:E.graphQLErrors,networkError:null==E?void 0:E.networkError}):h.isSingleton?"1"===f?(0,d.tZ)(d.Kq,{gap:"medium"},(0,d.tZ)(g.qX,{tone:"negative"},h.label," doesn't exist or you don't have access to it."),!w.keystone.adminMeta.list.hideCreate&&(0,d.tZ)(M.C,{list:h})):(0,d.tZ)(g.qX,{tone:"negative"},'The item with id "',f,'" does not exist'):(0,d.tZ)(g.qX,{tone:"negative"},'The item with id "',f,"\" could not be found or you don't have access to it.")):(0,d.tZ)(r.Fragment,null,(0,d.tZ)(S,{fieldModes:R,fieldPositions:T,selectedFields:y,showDelete:!w.keystone.adminMeta.list.hideDelete,listKey:v,itemGetter:I.get("item"),item:w.item}))))},T=(0,r.memo)(function(e){let{hasChangedFields:t,loading:i,onSave:l,onReset:n,deleteButton:a}=e;return(0,d.tZ)($.B,null,(0,d.tZ)(s.zx,{isDisabled:!t,isLoading:i,weight:"bold",tone:"active",onClick:l},"Save changes"),(0,d.tZ)(d.Kq,{align:"center",across:!0,gap:"small"},t?(0,d.tZ)(q,{onReset:n}):(0,d.tZ)(d.xv,{weight:"medium",paddingX:"large",color:"neutral600"},"No changes"),a))});function q(e){let[t,i]=(0,r.useState)(!1);return(0,d.tZ)(r.Fragment,null,(0,d.tZ)(s.zx,{weight:"none",onClick:()=>{i(!0)}},"Reset changes"),(0,d.tZ)(m.aR,{actions:{confirm:{action:()=>e.onReset(),label:"Reset changes"},cancel:{action:()=>i(!1),label:"Cancel"}},isOpen:t,title:"Are you sure you want to reset changes?",tone:"negative"},null))}let z=e=>{let{spacing:t}=(0,d.Fg)();return(0,d.tZ)("div",(0,l.Z)({css:{marginTop:t.xlarge,marginBottom:t.xxlarge,position:"sticky",top:t.xlarge}},e))}},31928:function(e,t,i){"use strict";i.d(t,{C:function(){return o}});var l=i(25631),n=i(25445),a=i(51511);let o=e=>(0,n.tZ)(l.zx,{css:{textDecoration:"none",":hover":{color:"white"}},as:a.rU,href:`/${e.list.path}/create`,tone:"active",size:"small",weight:"bold"},"Create ",e.list.singular)},20927:function(e,t,i){"use strict";i.d(t,{B:function(){return c},C:function(){return u},I:function(){return d}});var l=i(7896),n=i(25445),a=i(25273),o=i(2784),r=i(51511);let s=e=>{let{children:t,...i}=e;return(0,n.tZ)("div",(0,l.Z)({css:{minWidth:0,maxWidth:1080}},i),t)};function d(e){let{palette:t,spacing:i}=(0,n.Fg)();return(0,n.tZ)(s,{css:{alignItems:"center",display:"flex",flex:1,justifyContent:"space-between"}},(0,n.tZ)("div",{css:{alignItems:"center",display:"flex",flex:1,minWidth:0}},e.list.isSingleton?(0,n.tZ)(n.X6,{type:"h3"},e.list.label):(0,n.tZ)(o.Fragment,null,(0,n.tZ)(n.X6,{type:"h3"},(0,n.tZ)(r.rU,{href:`/${e.list.path}`,css:{textDecoration:"none"}},e.list.label)),(0,n.tZ)("div",{css:{color:t.neutral500,marginLeft:i.xsmall,marginRight:i.xsmall}},(0,n.tZ)(a.X,null)),(0,n.tZ)(n.X6,{as:"h1",type:"h3",css:{minWidth:0,maxWidth:"100%",overflow:"hidden",flex:1,textOverflow:"ellipsis",whiteSpace:"nowrap"}},e.label))))}function u(e){let{spacing:t}=(0,n.Fg)();return(0,n.tZ)(s,{css:{position:"relative",height:"100%"}},(0,n.tZ)("div",(0,l.Z)({css:{alignItems:"start",display:"grid",gap:t.xlarge,gridTemplateColumns:"2fr 1fr"}},e)))}function c(e){let{colors:t,spacing:i}=(0,n.Fg)();return(0,n.tZ)("div",{css:{background:t.background,borderTop:`1px solid ${t.border}`,bottom:0,display:"flex",justifyContent:"space-between",marginTop:i.xlarge,paddingBottom:i.xlarge,paddingTop:i.xlarge,position:"sticky",zIndex:20}},e.children)}},13123:function(e,t,i){"use strict";i.d(t,{K:function(){return a}});var l=i(2784),n=i(8958);i(25445);let a=(0,n.c)(l.createElement(l.Fragment,null,l.createElement("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),l.createElement("rect",{x:8,y:2,width:8,height:4,rx:1,ry:1})),"ClipboardIcon")},34273:function(e){function t(){return new DOMException("The request is not allowed","NotAllowedError")}async function i(e){if(!navigator.clipboard)throw t();return navigator.clipboard.writeText(e)}async function l(e){let i=document.createElement("span");i.textContent=e,i.style.whiteSpace="pre",i.style.webkitUserSelect="auto",i.style.userSelect="all",document.body.appendChild(i);let l=window.getSelection(),n=window.document.createRange();l.removeAllRanges(),n.selectNode(i),l.addRange(n);let a=!1;try{a=window.document.execCommand("copy")}finally{l.removeAllRanges(),window.document.body.removeChild(i)}if(!a)throw t()}async function n(e){try{await i(e)}catch(i){try{await l(e)}catch(e){throw e||i||t()}}}/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */e.exports=n}}]);