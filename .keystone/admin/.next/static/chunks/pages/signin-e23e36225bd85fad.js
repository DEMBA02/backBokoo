(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2176],{99798:function(t,e,n){"use strict";n.d(e,{S:function(){return s},u:function(){return u}});var i=n(25445),a=n(51511),r=n(2784);let s=t=>{let{children:e,title:n}=t,{colors:r,shadow:s}=(0,i.Fg)();return(0,i.tZ)("div",null,(0,i.tZ)(a.Fb,null,(0,i.tZ)("title",null,n||"Keystone")),(0,i.tZ)(i.M5,{css:{minWidth:"100vw",minHeight:"100vh",backgroundColor:r.backgroundMuted},rounding:"medium"},(0,i.tZ)(i.xu,{css:{background:r.background,width:600,boxShadow:s.s100},margin:"medium",padding:"xlarge",rounding:"medium"},e)))},u=()=>{let t=(0,a.tv)(),e=(0,r.useMemo)(()=>{let{from:e}=t.query;return"string"==typeof e&&e.startsWith("/")&&"/no-access"!==e?e:"/"},[t]);return e}},24176:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/signin",function(){return n(45801)}])},45801:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return f}});var i,a=n(33028),r=n(2784),s=n(25445),u=n(25631),o=n(74944),d=n(43900),l=n(10081),c=n(33379),g=n(91321),m=n(51511),h=n(99798);let v=t=>{var e,n;let{identityField:i,secretField:v,mutationName:f,successTypename:p,failureTypename:Z}=t,y=l.Ps`
    mutation($identity: String!, $secret: String!) {
      authenticate: ${f}(${i}: $identity, ${v}: $secret) {
        ... on ${p} {
          item {
            id
          }
        }
        ... on ${Z} {
          message
        }
      }
    }
  `,[w,_]=(0,r.useState)("signin"),[b,S]=(0,r.useState)({identity:"",secret:""}),[k,E]=(0,r.useState)(!1),$=(0,r.useRef)(null);(0,r.useEffect)(()=>{var t;null===(t=$.current)||void 0===t||t.focus()},[w]);let[F,{error:q,loading:x,data:C}]=(0,c.D)(y),K=(0,g.Mz)(),M=(0,m.tv)(),N=(0,g.gS)(),P=(0,h.u)();(0,r.useEffect)(()=>{k||"authenticated"!==N.authenticatedItem.state||M.push(P)},[N.authenticatedItem,M,P,k]),(0,r.useEffect)(()=>{var t,e;if(k){if((null===(t=N.adminMeta)||void 0===t?void 0:null===(e=t.error)||void 0===e?void 0:e.message)==="Access denied"){M.push("/no-access");return}M.push(P)}},[N.adminMeta,M,P,k]);let T=async t=>{if(t.preventDefault(),"signin"===w){try{var e;let{data:t}=await F({variables:{identity:b.identity,secret:b.secret}});if((null===(e=t.authenticate)||void 0===e?void 0:e.__typename)!==p)return}catch(t){console.error(t);return}await K(),E(!0)}};return(0,s.tZ)(h.S,{title:"Keystone - Sign in"},(0,s.tZ)(s.Kq,{gap:"xlarge",as:"form",onSubmit:T},(0,s.tZ)(s.H1,null,"Sign In"),q&&(0,s.tZ)(d.qX,{title:"Error",tone:"negative"},q.message),(null==C?void 0:null===(e=C.authenticate)||void 0===e?void 0:e.__typename)===Z&&(0,s.tZ)(d.qX,{title:"Error",tone:"negative"},null==C?void 0:C.authenticate.message),(0,s.tZ)(s.Kq,{gap:"medium"},(0,s.tZ)(s.TX,{as:"label",htmlFor:"identity"},i),(0,s.tZ)(o.oi,{id:"identity",name:"identity",value:b.identity,onChange:t=>S((0,a.Z)((0,a.Z)({},b),{},{identity:t.target.value})),placeholder:i,ref:$}),"signin"===w&&(0,s.tZ)(r.Fragment,null,(0,s.tZ)(s.TX,{as:"label",htmlFor:"password"},v),(0,s.tZ)(o.oi,{id:"password",name:"password",value:b.secret,onChange:t=>S((0,a.Z)((0,a.Z)({},b),{},{secret:t.target.value})),placeholder:v,type:"password"}))),"forgot password"===w?(0,s.tZ)(s.Kq,{gap:"medium",across:!0},(0,s.tZ)(u.zx,{type:"submit",weight:"bold",tone:"active"},"Log reset link"),(0,s.tZ)(u.zx,{weight:"none",tone:"active",onClick:()=>_("signin")},"Go back")):(0,s.tZ)(s.Kq,{gap:"medium",across:!0},(0,s.tZ)(u.zx,{weight:"bold",tone:"active",isLoading:x||(null==C?void 0:null===(n=C.authenticate)||void 0===n?void 0:n.__typename)===p,type:"submit"},"Sign in"))))};var f=(i={identityField:"email",secretField:"password",mutationName:"authenticateUserWithPassword",successTypename:"UserAuthenticationWithPasswordSuccess",failureTypename:"UserAuthenticationWithPasswordFailure"},()=>(0,s.tZ)(v,i))}},function(t){t.O(0,[2888,9774,179],function(){return t(t.s=24176)}),_N_E=t.O()}]);